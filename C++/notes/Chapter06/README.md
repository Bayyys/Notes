# 第六章 分支语句和逻辑运算符

本章的内容包括：

- `if` 语句；
- `if else` 语句；
- 逻辑运算符：`&&`、`||` 和 `!`；
- `cctype` 字符函数库；
- 条件运算符：`?:`；
- `switch` 语句；
- `continue` 和 `break` 语句；
- 读取数字的循环；
- 基本文件输入/输出。

# 1. `if` 语句

如果测试条件为 `true`， 则 `if` 语句将引导程序执行语句或语句块；如果条件是`false`，程序将跳过 这条语句或语句块。因此，`if` 语句让程序能够决定是否应执行特定的语句。

```cpp
if (test-condition)
    statement
```

## 1.1 `if else` 语句

`if` 语句让程序决定是否执行特定的语句或语句块，而`if else`语句则让程序决定执行两条语句或语句块中的哪一条，这种语句对于选择其中一 种操作很有用。

`if else` 语句的通用格式如下：

```cpp
if (test-condition)
    statement1
else
    statement2
```

<img src="https://s2.loli.net/2023/07/19/1zwcZCIfWKvPpD3.png" alt="image-20210728225606236" style="zoom: 50%;" />

## 1.2  `if`- `else if`- `else` 结构

计算机程序也可能提供两个以上的 选择。可以将`C++`的 `if else` 语句进行扩展来满足这种需求。正如读者知 道的，`else` 之后应是一条语句，也可以是语句块。由于 `if else` 语句本身是 一条语句，所以可以放在 `else` 的后面

# 2. 逻辑表达式

C++ 提供了3种逻辑运算符，来组合或修改已有的表达式。这些运算符分别是逻 辑 `OR (||)`、逻辑 `AND (&&)`和逻辑 `NOT (!)`。

## 2.1 运算符关系

![image-20210728230438579](https://s2.loli.net/2023/07/19/F16y3kp5LOWfHQ7.png)

![image-20210728230605370](https://static.fungenomics.com/images/2021/07/image-20210728230605370.png)

## 2.2 逻辑运算符细节

`!` 运算符的优先级高于所有的关系运算符和算术运算符。因此，要对表达式求反，必须用括号将其括起。

## 2.3 其他表示方式

并不是所有的键盘都提供了用作逻辑运算符的符号，因此C++标准 提供了另一种表示方式，如表6.3所示。标识符`and`、`or`和`not`都是C++保 留字，这意味着不能将它们用作变量名等。它们不是关键字，因为它们 都是已有语言特性的另一种表示方式。另外，它们并不是C语言中的保 留字，但C语言程序可以将它们用作运算符，只要在程序中包含了头文 件 `iso646.h`。C++不要求使用头文件。

![image-20210728232023659](https://s2.loli.net/2023/07/19/plOeyrnUgYcF6Bi.png)

# 3. 字符函数库 `cctype`

![image-20210728232856482](https://s2.loli.net/2023/07/19/lZ1QMUAEdyiIsVu.png)

![image-20210728232930054](https://s2.loli.net/2023/07/19/nwPYyOxVDE8deC3.png)

# 4. `?:` 运算符

C++有一个常被用来代替 `if else` 语句的运算符，这个运算符被称为条件运算符 `?:`，它是C++中唯一一个需要3个操作数的运算符，也叫**三目运算符**。

```Cpp
expression1 ? expression2 : expression3
```
如果 `expression1` 为 `true`，则整个条件表达式的值为 `expression2` 的值； 否则，整个表达式的值为 `expression3` 的值。

# 5. `switch`语句

```cpp
switch (integer-expression)
{
    case label1: statement(s)
    case label2: statement(s)
    ...
    [default: statement(s)]
}
```

- 程序跳到 `switch` 中特定代码行后，将依次执行之后的所有语句，除非有明确的其他指示。程序不会在执行到下一个 `case` 处自动停止，**要让程序执行 完一组特定语句后停止，必须使用`break` 语句**。

## 5.1 将枚举量用作标签

当 `switch` 语句将 `int` 值和枚举量标签进行比较时，将枚举量提升为 `int`。另 外，在 `while` 循环测试条件中，也会将枚举量提升为 `int` 类型。

## 5.2 `switch` 和 `if else`

`switch`语句和`if else`语句都允许程序从选项中进行选择。相比之下， `if else`更通用，例如，它可以处理取值范围。

然而，`switch`并不是为处理取值范围而设计的。`switch`语句中的每 一个`case`标签都必须是一个单独的值。另外，这个值必须是整数（包括 `char`），因此 `switch` 无法处理浮点测试。

# 6. 简单文件输入/输出

## 6.1 写入到文本文件中

文件输出：

- 必须包含头文件 `fstream`；
- 头文件 `fstream` 定义了一个用于处理输出的 `ofstream` 类；
- 需要声明一个或多个 `ofstream` 变量（对象），并以自己喜欢的方式 对其进行命名，条件是遵守常用的命名规则；
- 必须指明名称空间 `std`。例如，为引用元素 `ofstream`，必须使用编译指令`using` 或前缀 `std::`；
- 需要将 `ofstream` 对象与文件关联起来。为此，方法之一是使用 `open()` 方法；
- 使用完文件后，应使用方法 `close()` 将其关闭；
- 可结合使用 `ofstream` 对象和运算符 `<<` 来输出各种类型的数据。

虽然头文件 `iostream` 提供了一个预先定义好的名为 `cout` 的 `ostream` 对象，但您必须声明自己的 `ofstream` 对象，为其命名，并将其同文件关联起来。

![image-20210729232741786](https://s2.loli.net/2023/07/19/UmPTk7GKjLweEJX.png)

注意，方法`open()` 只接受C-风格字符串作为参数，这可以是一个 字面字符串，也可以是存储在数组中的字符串。

重要的是，声明一个`ofstream`对象并将其同文件关联起来后，便可以像使用cout那样使用它。所有可用于cout的操作和方法（如<<、endl 和setf( )）都可用于ofstream对象（如前述示例中的outFile和fout）。

总之，使用文件输出的主要步骤如下：

- 包含头文件 `fstream`；
- 创建一个 `ofstream` 对象；
- 将该 `ofstream` 对象同一个文件关联起来；
- 就像使用 `cout` 那样使用该 `ofstream` 对象;
- 调用 `close()` 成员函数，关闭文件。

> 默认情况下，`open()` 的将首先截断该文件，即将其长度截短到零——丢弃原有的内容，然后将新的输出加入到该文件中。

### 6.8.3 读取文本文件

接下来介绍文本文件输入，它是基于控制台输入的。控制台输入涉 及多个方面，下面首先总结这些方面：

- 必须包含头文件 `fstream`；
- 头文件 `fstream` 定义了一个用于处理输入的 `ifstream` 类；
- 需要声明一个或多个 `ifstream` 变量（对象），并以自己喜欢的方式对其进行命名，条件是遵守常用的命名规则；
- 必须指明名称空间 `std`；例如，为引用元素 `ifstream`，必须使用编译指令`using`或前缀`std::`；
- 需要将 `ifstream` 对象与文件关联起来。为此，方法之一是使用 `open()` 方法；
- 使用完文件后，应使用 `close()` 方法将其关闭；
- 可结合使用 `ifstream` 对象和运算符 `>>` 来读取各种类型的数据；
- 可以使用 `ifstream` 对象和 `get()` 方法来读取一个字符，使用 `ifstream` 对象和 `getline()` 来读取一行字符；
- 可以结合使用 `ifstream` 和 `eof()`、`fail()` 等方法来判断输入是否成功；
- `ifstream` 对象本身被用作测试条件时，如果最后一个读取操作成 功，它将被转换为布尔值 `true`，否则被转换为 `false`。

如果试图打开一个不存在的文件用于输入，情况将如何呢？这种错误将导致后面使用`ifstream` 对象进行输入时失败。检查文件是否被成功打开的首选方法是使用`is_open()`，为此，可以使用类似于下面的代码：

```Cpp
inFile.open("b.txt");
if (!inFile.is_open()) {
    exit(EXIT_FEAILURE);
}
```

- 检查文件是否被成功打开至关重要

如果文件被成功地打开，方法 `is_open()` 将返回 `true`；因此如果文件没有被打开，表达式 `!inFile.is_open()` 将为 `true`。函数 `exit()` 的原型是在头文件 `cstdlib` 中定义的，在该头文件中，还定义了一个用于同操作系统通信的参数值 `EXIT_FAILURE`。函数 `exit()` 终止程序。

> 方法 `is_open()` 是C++中相对较新的内容。如果读者的编译器不支持它，可使用较老的方法 `good()` 来代替。

读取文件时，有 几点需要检查。首先，程序读取文件时不应超过 EOF。如果最后一次读取数据时遇到 `EOF`，方法 `eof()` 将返回 `true`。其次，程序可能遇到类型不 匹配的情况。例如，程序清单6.16期望文件中只包含数字。如果最后一次读取操作中发生了类型不匹配的情况，方法 `fail()` 将返回 `true`（如果遇到了 `EOF`，该方法也将返回 `true`）。最后，可能出现意外的问题，如文 件受损或硬件故障。如果最后一次读取文件时发生了这样的问题，方法 `bad()` 将返回 `true`。不要分别检查这些情况，一种更简单的方法是使用 `good()` 方法，该方法在没有发生任何错误时返回 `true`：

```Cpp
while (inFile.good()) {
    ......
}
```

方法 `good()` 指出最后一次读取输入的操作是否成功，这一点至关重要。这意味着应该在执行读取输入的操作后，立刻应用这种测试。为此，一种标准方法是，在循环之前（首次执行循环测试前）放置一条输 入语句，并在循环的末尾（下次执行循环测试之前）放置另一条输入语句：

```Cpp
// standard file-reading loop design
inFile >> value;         // get first value
while (inFile.good()) {  // while uput good and not at EOF
    //loop body goes here
    inFile >> value;     // get next value
}
```

鉴于以下事实，可以对上述代码进行精简：表达式  `inFile >> value`  的结果为`inFile`，而在需要一个 `bool` 值的情况下，`inFile` 的结果为 `inFile.good()`，即 `true` 或 `false`。

因此，可以将两条输入语句用一条用作循环测试的输入语句代替。 也就是说，可以将上述循环结构替换为如下循环结构：

这些代码紧跟在循环的后面，用于判断循环为何终止。由于 `eof()` 只能判断是否到达 `EOF`，而 `fail()` 可用于检查 `EOF` 和类型不匹配，因此上述 代码首先判断是否到达 `EOF`。这样，如果执行到了 `else if` 测试，便可排除 `EOF`，因此，如果 `fail()` 返回 `true`，便可断定导致循环终止的原因是类型不匹配。
