# ECE2013 2022 年秋季

# 作业 2：规划、游戏

在本作业中，您将解决约束满足问题，并为两人游戏实现极小极大和 alpha-beta 修剪算法。在第 1 部分中，您将求解经典 CSP。在第 2 部分中，您将在终极井字游戏中练习编码 minimax 和 alpha-beta 修剪算法。

![image-20221018103407302](https://s2.loli.net/2022/10/18/93wJ2vXc6zUZSGu.png)

##  Programming language

对于第 1 部分，您可以使用 Python 标准库中的模块和 numpy.对于第 2 部分，您只能使用 Python 标准库中的模块。

# Part 1: Constraint Satisfaction Problem -约束满足问题

您的代码将需要 Numpy 库。

许多人都熟悉[Pentomino tiling](https://en.wikipedia.org/wiki/Pentomino) 的问题。问题陈述如下：给你一组形状，每个形状由 5 个相连的正方形和一个由 0 和 1 组成的棋盘组成。您需要将五联骨牌放置在棋盘上，以便 

- 五联骨牌可以翻转或旋转 
- 五联骨牌没有重叠
- 所有五联骨牌完全放在棋盘上
- 棋盘上的所有 1 都被五联牌覆盖
- 没有 0 被五联牌覆盖

你将负责解决这个问题。为了提供更简单的案例，您还将使用多米诺骨牌和三骨牌（分别由 2 个和 3 个正方形组成的形状）来平铺相同尺寸的板。

您在solve.py 中实现的功能将需要能够使用给定的一组瓷砖来平铺给定的板。这意味着该功能应该适用于任意输入图块和板。您可以假设我们在您的代码上测试的任何实例都有解决方案。您需要实现的求解函数的接口在solve.py 的文档字符串中描述。

# Part 2: Game of Ultimate Tic-Tac-Toe -终极井字游戏

对于这部分作业，您将使用 minimax 和 alpha-beta 修剪算法来实现游戏终极井字游戏。

![image-20221018103355559](https://s2.loli.net/2022/10/18/iDHG1gOmCyXJlTv.png)

## 规则

终极井字游戏的规则可以在[wiki page](https://en.wikipedia.org/wiki/Ultimate_tic-tac-toe)上找到。 Ultimate tic-tac-toe 是一款棋盘游戏，由 9 个井字棋盘组成，以 3×3 的网格排列。每个较小的 3x3 网格称为本地板，而 9x9 网格称为全局板。开始游戏的玩家可以将他们的移动放在任何空白处。第一步棋后，对方棋手必须在第一棋手所在方格对应的棋盘中下棋，如下图：

在上图中，在游戏开始时，由于玩家“X”在中央本地棋盘的右上角玩，玩家“O”被发送到右上方的本地棋盘，并且只允许在那里玩。 O 的下一步行动决定了 X 下一次必须下的棋盘，依此类推。

本地棋盘的规则与常规 3x3 井字棋相同。终极井字游戏有许多不同的规则；对于这部分作业，获胜者将是赢得第一个地方委员会的人（在任何地方委员会中第一个获胜的人）。

强烈建议同学们使用[在线工具](http://ultimatetictactoe.creativitygames.net/)来玩游戏，充分了解游戏规则。对于此在线工具，请记住从下拉列表中选择左上角的“First Tile Wins”。以下是终极井字游戏的示例图片。

![image-20221018103342731](https://s2.loli.net/2022/10/18/KFDQJ7bstOzS1yc.png)

## 要求

全球游戏板有 9 个本地板，有 81 个可用位置。每个空点的坐标是从0开始的行号和列号。每个本地板都有一个从0开始的索引。第一行本地板的索引从0到2，第二行本地板的索引从3 -5，以此类推。

对于这部分作业，您将首先实现预定义的进攻代理和预定义的防守代理以相互对抗。在提供的骨架代码中，maxPlayer 是进攻代理，minPlayer 是防守代理。游戏总是从中央地方棋盘开始（索引 4）。每个预定义代理的评估函数优先级为三个级别。

如果应用了较高级别的评估规则，则不会使用较低级别的评估规则。例如，如果第二条规则适用，则不会使用第三条规则。 Minimax 或 alpha-beta 搜索总是从左上角到右下角逐行搜索本地棋盘。搜索深度最多分为三个级别，包括当前玩家、对方玩家和再次当前玩家。然后评估第三级搜索后得到的棋盘位置。如果评估函数返回具有相同值的两个终端状态，则选择在此栅格搜索顺序中先出现的两个移动中的任何一个。

预定义进攻代理：

- 第一条规则：如果进攻代理获胜（三连胜），则将效用得分设置为 10000。
- 第二条规则：对于每个本地棋盘，计算没有被对方球员占据第三个位置的一排二排的数量（未被阻挡的二排二排）。对于每个未被阻挡的二合一，将效用得分增加 500。对于每个本地棋盘，计算您阻止对手玩家形成二合一（二合一）的位置数- 排对手球员，但进攻球员占据了第三个位置）。对于每个预防措施，将效用得分增加 100。

- 第三条规则：对于进攻方的每个角球，将效用得分增加 30。


预定义的防守代理：

- 第一条规则：如果防守代理获胜（形成三连胜），则将效用得分设置为 - 10000。
- 第二条规则：对于每个本地棋盘，计算没有对手玩家占据第三个位置的连续两个数。对于每排两排，将效用得分减 100。对于每个本地棋盘，计算对手球员形成排两排的阻止次数（两排对手球员但第三个位置被防守队员占据）。对于每个预防措施，将效用得分降低 500。
- 第三条规则：防守队员每获得一个角球，将效用得分减 30。

您的任务如下： 

- 首先实现预定义的进攻和防守代理，以进行四场比赛：进攻（minimax）vs 防守（minimax），进攻（minimax）vs 防守（alpha-beta），进攻（alpha- beta) vs 防御性(minimax)，以及进攻性(alphabeta) vs 防御性(alpha-beta)。在前两场比赛中，maxPlayer 排在第一位，而在其余比赛中，minPlayer 排在第一位。报告每场比赛的最终棋盘位置、扩展节点数和最终获胜者。
- 然后想出一个更智能的评估功能，以至少 80% 的时间击败进攻代理。对两个代理进行 alpha-beta 修剪游戏至少 20 次，起始本地棋盘索引和起始玩家都是随机设置的。在你的报告中，解释你的公式，以及你的评估函数的优点。报告每场比赛的获胜时间百分比和扩展节点数。报告 3-5 个具有代表性的最终游戏板，显示您的评估函数与预定义的进攻性评估函数的优势。
- 让人类使用您自己定义的评估函数玩至少 10 场比赛。报告 3-5 个具有代表性的最终游戏板，显示您的评估功能的优缺点。讨论结果和发现。人类总能战胜代理人吗？如果是这样，评估函数没有做什么？

## 小贴士

- 使用在线工具熟悉游戏规则，同时获得一些设计好的评价函数的直觉。
- 确保按描述实施预定义代理。您的实施将根据正确率进行评分。
- 确定提出良好评估函数的关键步骤，并将您的想法转化为数学方程式。

 提供的代码骨架 我们提供了（tar 文件或 zip 文件）所有代码，让您开始使用 MP。不要修改提供的代码。

对于第 2.1 部分，您将获得以下内容：

- solve.py - 这是您需要修改的唯一 python 文件。

- Pentomino.py - 这包含有用的验证算法。

- instance.py - 这包含示例五联骨牌组和板。


对于第 2.2 部分，您将获得以下内容：uttt.py

这是您需要修改以使代码运行的唯一 python 文件。 python 文件中的文档字符串解释了每个函数的用途。

- evaluatePredifined()：该函数实现了预定义代理的最终井字游戏的评估函数。

- evaluateDesigned()：该函数实现您自己的评估函数
- checkMovesLeft()：该函数检查棋盘上是否有任何合法的移动。
- checkWinner()：该函数检查是否有玩家赢得比赛。

- alphabeta()：该函数实现了最终井字游戏的 alpha-beta 修剪算法。

- minimax()：这个函数实现了终极井字游戏的极小极大算法。

- playGamePredifinedAgent()：该函数实现了预定义代理相互对战的游戏。

- playGameYourAgent()：此函数实现您的代理与预定义的进攻代理的游戏。

- playGameHuman()：此函数实现人类对战代理的游戏。


##  Extra Credit Suggestion 

Ultimate tic-tac-toe 有多个版本。一旦每个本地棋盘获胜，本地棋盘将被标记为相应玩家的胜利。当三个地方棋盘排成一排时，游戏结束。如果本地棋盘已获胜，则不能在该棋盘上再下棋。用你自己的进攻和防守特工来实现这个游戏。玩游戏至少 10 次。解释你的评估函数并报告 3-5 个有代表性的最终游戏棋盘位置。请注意，额外学分的上限为作业价值的 10%。

## 可交付成果

此 MP 将通过 Blackboard 提交。

请仅将以下三个文件上传到 Blackboard。

1. solve.py - 第 1 部分的解决方案 python 文件 
2. uttt.py - 第 2 部分的解决方案 python 文件 
3. report.pdf - pdf 格式的项目报告

## 报告清单

您的报告应该简要描述您实施的解决方案并完整回答作业每个部分的问题。您的描述应侧重于解决方案中最“有趣”的方面，即任何不明显的实现选择和参数设置，以及您发现对获得良好性能特别重要的内容。如果需要它们来阐明您的方法，请随意包含伪代码或图形。您的报告应该是独立的，并且它应该（理想情况下）使我们能够理解您的解决方案而无需运行您的源代码。

请将报告结构如下：

1. 标题页：所有团队成员的列表、每个成员注册的课程编号和部分、报告的撰写日期 2. 第 I 部分：CSP：我们希望描述您对问题的陈述以及您用来寻找解决方案的算法（以及启发式方法）的解释。

3. 第二部分：终极井字游戏：对于预定义代理的四场比赛中的每一场，报告最终的游戏棋盘位置、扩展节点数和最终获胜者。

4. 第三节：终极井字游戏：至少 20 场进攻代理对你的代理，解释你的评估函数的制定和优势。报告每场比赛的获胜时间百分比和扩展节点数。报告 3-5 个具有代表性的最终游戏板，显示您的评估函数与预定义的进攻性评估函数的优势。如果您自己定义的代理未能击败预定义的代理，请解释发生这种情况的原因。

5. 第四部分：终极井字游戏：对于至少 10 场人类与您的代理的比赛，讨论您的观察结果，包括获胜时间的百分比、您定义的评估函数的优缺点。报告 3-5 个具有代表性的最终游戏板，显示评估功能的优缺点。

6. 额外得分：如果您完成了任何您认为应该获得额外得分的工作，请在此处描述 7. 贡献声明：指定哪个团队成员执行了哪个任务。如果适用，我们鼓励您将其设为多对多映射。例如，您可以说“Rahul 和 Jason 都实现了 BFS 功能，将它们的结果进行了比较以进行调试，并提交了 Rahul 的代码。

Jason 和 Mark 都实现了 DFS 功能，Mark 的代码一直没有运行成功，所以提交了 Jason 的代码。报告的第一部分由所有 3 名团队成员撰写。

马克和杰森的第二部分，拉胡尔和杰森的第三部分。 “.. 等等。

**警告：您将不会因您获得的任何解决方案而获得荣誉，但未包含在您的报告中！**

您的报告必须是格式化的 pdf 文件。**你可以用英文或中文写你的报告。**图片和示例输出应包含在文档中。例外：非常大或不适合包含在 pdf 文档中的项目（例如视频或动画 gif）可能会放在网络上，并且 URL 会包含在您的报告中。

## 额外积分

我们保留为您实施的任何高级探索或特别具有挑战性或创造性的解决方案提供奖励积分的权利。这包括但不限于上面给出的额外信用建议。